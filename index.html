<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>CryptoBlur — Trading Platform Demo</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            /* New cyberpunk theme */
            --bg-color: #1a1a1a;
            --panel-bg: rgba(32, 32, 32, 0.85);
            --neon-blue: #0ff;
            --neon-purple: #f0f;
            --neon-yellow: #ff0;
            --glass-blur: blur(20px);
            --text-main: #fff;
            --text-muted: #888;
        }

        html, body {
            height: 100%;
            margin: 0;
            font-family: 'Inter', sans-serif;
            background: var(--bg-color);
            color: var(--text-main);
            overflow-x: hidden;
        }

        body {
            min-height: 100vh;
            position: relative;
        }

        /* Neon background effects */
        .crypto-symbols {
            position: fixed;
            inset: 0;
            z-index: 0;
            overflow: hidden;
            opacity: 0.15;
        }

        .crypto-symbol {
            position: absolute;
            font-size: 12rem;
            filter: blur(4px);
            animation: neonPulse 4s infinite;
        }

        @keyframes neonPulse {
            0%, 100% { opacity: 0.3; filter: blur(4px); text-shadow: 0 0 20px var(--neon-blue); }
            50% { opacity: 0.6; filter: blur(6px); text-shadow: 0 0 40px var(--neon-purple); }
        }

        /* New navigation */
        .nav-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: var(--panel-bg);
            backdrop-filter: var(--glass-blur);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-link {
            color: var(--text-main);
            text-decoration: none;
            font-size: 1.1rem;
            transition: color 0.3s;
        }

        .nav-link:hover {
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue);
        }

        /* Layout */
        .container {
            margin-top: 4rem;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem 4rem 1rem;
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 2rem;
            align-items: flex-start;
        }

        @media (max-width: 900px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
        }

        /* Portfolio Panel */
        .portfolio-panel {
            min-width: 260px;
        }

        .portfolio-balance {
            font-size: 2.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            transform-origin: center;
            animation: portfolioPulse var(--pulse-duration) ease-in-out infinite;
        }

        @keyframes portfolioPulse {
            0% { transform: scale(1); box-shadow: 0 8px 28px var(--portfolio-glow); }
            50% { transform: scale(var(--pulse-scale)); box-shadow: 0 14px 48px var(--portfolio-glow); }
            100% { transform: scale(1); box-shadow: 0 8px 28px var(--portfolio-glow); }
        }

        .portfolio-pnl {
            font-size: 1.1rem;
            color: var(--success);
            margin-bottom: 1.2rem;
        }

        .portfolio-chart {
            width: 100%;
            height: 140px;
            margin-bottom: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Asset Cards */
        .assets-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .asset-card {
            background: var(--panel-bg);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            border-radius: 14px;
            padding: 1rem 1.2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: box-shadow 0.3s, border-color 0.3s;
            position: relative;
        }

        .asset-card .asset-symbol {
            font-weight: 600;
            font-size: 1.1rem;
            letter-spacing: 0.03em;
        }

        .asset-card .asset-price {
            font-size: 1.1rem;
            font-weight: 500;
            margin-left: 1.2rem;
        }

        .asset-card .asset-change {
            font-size: 1rem;
            margin-left: 1.2rem;
            font-weight: 500;
            border-radius: 8px;
            padding: 0.2em 0.7em;
            background: rgba(44,229,155,0.08);
            color: var(--success);
            transition: background 0.3s, color 0.3s;
        }

        .asset-card.negative .asset-change {
            background: rgba(255,60,110,0.08);
            color: var(--danger);
        }

        /* TradingView Panel */
        .tradingview-panel {
            min-height: 600px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .tradingview-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .tradingview-header .title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .tradingview-tools {
            display: flex;
            gap: 0.5rem;
        }

        .tradingview-tools button {
            background: rgba(127,90,240,0.12);
            border: none;
            color: var(--accent);
            border-radius: 8px;
            padding: 0.4em 1em;
            font-size: 0.95rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .tradingview-tools button:hover {
            background: rgba(127,90,240,0.22);
        }

        .tradingview-iframe {
            width: 100%;
            height: 500px;
            border: none;
            border-radius: 12px;
            overflow: hidden;
            background: rgba(24,28,47,0.7);
            box-shadow: 0 2px 24px 0 #7f5af022;
        }

        /* Order Book & Trade History */
        .orderbook-panel, .tradehistory-panel {
            min-width: 220px;
            max-height: 420px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .orderbook-table, .tradehistory-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.98rem;
        }

        .orderbook-table th, .orderbook-table td,
        .tradehistory-table th, .tradehistory-table td {
            padding: 0.5em 0.7em;
            text-align: right;
            border-bottom: 1px solid rgba(127,90,240,0.08);
        }

        .orderbook-table th, .tradehistory-table th {
            color: var(--accent);
            font-weight: 600;
            background: rgba(127,90,240,0.06);
        }

        /* Order Form */
        .order-form-panel {
            margin-top: 1.2rem;
            background: var(--panel-bg);
            border-radius: 14px;
            border: var(--glass-border);
            box-shadow: 0 2px 16px 0 #7f5af011;
            padding: 1rem 1.2rem;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .order-form-panel label {
            font-size: 0.98rem;
            color: var(--text-muted);
            margin-bottom: 0.2em;
        }

        .order-form-panel input, .order-form-panel select {
            background: rgba(24,28,47,0.55);
            border: 1px solid #7f5af022;
            border-radius: 8px;
            color: var(--text-main);
            padding: 0.5em 0.8em;
            font-size: 1rem;
            outline: none;
            margin-bottom: 0.5em;
            transition: border-color 0.2s;
        }

        .order-form-panel input:focus, .order-form-panel select:focus {
            border-color: var(--accent);
        }

        .order-form-panel button {
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 0.6em 1.2em;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 12px 0 var(--accent-glow);
            transition: background 0.2s;
        }

        .order-form-panel button:hover {
            background: #5f3ad6;
        }

        /* Emotional Market Indicator */
        .market-indicator {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 10;
            width: 72px;
            height: 72px;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .market-indicator-canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            filter: blur(2px) brightness(1.2);
            box-shadow: 0 0 24px 0 var(--accent-glow);
            background: transparent;
        }

        /* Focus Mode */
        .focus-overlay {
            position: fixed;
            inset: 0;
            z-index: 20;
            background: rgba(24,28,47,0.85);
            backdrop-filter: blur(32px);
            transition: opacity 0.4s;
            opacity: 0;
            pointer-events: none;
        }

        .focus-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 30;
            min-width: 260px;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border-radius: 14px;
            border: var(--glass-border);
            box-shadow: 0 2px 24px 0 var(--accent-glow);
            color: var(--text-main);
            padding: 1rem 1.2rem;
            opacity: 0;
            transform: translateY(40px);
            transition: opacity 0.5s, transform 0.5s;
            pointer-events: none;
        }

        .notification.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        /* Academy Section */
        .academy-section {
            margin-top: 3rem;
            margin-bottom: 2rem;
        }

        .academy-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.2rem;
            color: var(--accent);
        }

        .academy-cards {
            display: flex;
            gap: 1.2rem;
            overflow-x: auto;
            padding-bottom: 1rem;
        }

        .academy-card {
            min-width: 220px;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border-radius: 14px;
            border: var(--glass-border);
            box-shadow: 0 2px 16px 0 #7f5af011;
            padding: 1rem 1.2rem;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.7rem;
            transition: box-shadow 0.3s, border-color 0.3s;
        }

        .academy-card .icon {
            font-size: 2rem;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }

        .academy-card .card-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.3rem;
        }

        .academy-card .card-desc {
            font-size: 0.98rem;
            color: var(--text-muted);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 1rem 0.2rem 2rem 0.2rem;
            }

            .market-indicator {
                top: 1rem;
                right: 1rem;
                width: 52px;
                height: 52px;
            }

            .notification {
                bottom: 1rem;
                right: 1rem;
                min-width: 180px;
                padding: 0.7rem 0.8rem;
            }

            .academy-cards {
                gap: 0.7rem;
            }

            .academy-card {
                min-width: 160px;
                padding: 0.7rem 0.7rem;
            }
        }

        /* smooth transitions when theme variables change */
        body, .glass-panel, .asset-card, .tradingview-iframe, .academy-card {
            transition: background 600ms, color 600ms, box-shadow 600ms, border-color 600ms, transform 300ms;
        }

        /* Settings panel (compact) */
        .settings-panel {
            position: fixed;
            left: 1rem;
            top: 1rem;
            z-index: 40;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border-radius: 12px;
            border: var(--glass-border);
            padding: 0.6rem 0.8rem;
            display: flex;
            gap: 0.6rem;
            align-items: center;
            box-shadow: 0 8px 24px 0 rgba(0,0,0,0.35);
            color: var(--text-main);
            font-size: 0.9rem;
        }

        .settings-panel input[type="range"] { width: 90px; }
        .settings-panel select { background: rgba(24,28,47,0.6); color: var(--text-main); border-radius: 6px; padding: 0.2rem 0.4rem; border: 1px solid #7f5af022; }

        /* Make sure blurred canvases use CSS size provided by canvas element */
        .blur-bg-canvas, .market-indicator-canvas {
            width: 100vw;
            height: 100vh;
            image-rendering: optimizeQuality;
        }
    </style>
</head>
<body>
    <!-- Neon Crypto Symbols Background -->
    <div class="crypto-symbols">
        <div class="crypto-symbol" style="top:10%;left:5%;">₿</div>
        <div class="crypto-symbol" style="top:40%;right:10%;">Ξ</div>
        <div class="crypto-symbol" style="bottom:20%;left:15%;">◎</div>
        <div class="crypto-symbol" style="top:60%;right:20%;">Ð</div>
    </div>

    <!-- Navigation Bar -->
    <nav class="nav-bar">
        <div class="nav-links">
            <a href="/" class="nav-link">Trading</a>
            <a href="/portfolio" class="nav-link">Portfolio</a>
            <a href="/analytics" class="nav-link">Analytics</a>
            <a href="/academy" class="nav-link">Academy</a>
        </div>
        <div class="nav-tools">
            <button id="themeBtn" class="nav-link">Theme</button>
            <button id="settingsBtn" class="nav-link">Settings</button>
        </div>
    </nav>

    <!-- Animated Blur Background -->
    <div class="blur-bg">
        <canvas id="blurBgCanvas" class="blur-bg-canvas"></canvas>
    </div>
    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <label for="themeSelect">Тема</label>
        <select id="themeSelect">
            <option value="auto">Авто (по активу)</option>
            <option value="BTC">BTC</option>
            <option value="ETH">ETH</option>
            <option value="SOL">SOL</option>
        </select>
        <label title="Размытие фона">Blur</label>
        <input id="blurSlider" type="range" min="0" max="40" value="18">
        <label title="Прозрачность панелей">Glass</label>
        <input id="glassSlider" type="range" min="0.2" max="0.95" step="0.01" value="0.55">
    </div>
    <!-- Emotional Market Indicator -->
    <div class="market-indicator">
        <canvas id="marketIndicatorCanvas" class="market-indicator-canvas"></canvas>
    </div>
    <!-- Focus Mode Overlay -->
    <div id="focusOverlay" class="focus-overlay"></div>
    <!-- Notification -->
    <div id="notification" class="notification"></div>
    <!-- Main Container -->
    <div class="container">
        <!-- Dashboard -->
        <div class="dashboard-grid">
            <!-- Portfolio Panel -->
            <div class="glass-panel portfolio-panel">
                <div class="portfolio-balance" id="portfolioBalance">₿ 12.34</div>
                <div class="portfolio-pnl">+2.7% за неделю</div>
                <div class="portfolio-chart">
                    <!-- Placeholder for donut chart -->
                    <canvas id="portfolioChart" width="120" height="120"></canvas>
                </div>
                <div class="assets-list">
                    <div class="asset-card" id="assetBTC" data-symbol="BTC">
                        <span class="asset-symbol">BTC</span>
                        <span class="asset-price">₿ 67,200</span>
                        <span class="asset-change">+1.2%</span>
                    </div>
                    <div class="asset-card negative" id="assetETH" data-symbol="ETH">
                        <span class="asset-symbol">ETH</span>
                        <span class="asset-price">Ξ 3,420</span>
                        <span class="asset-change">-0.8%</span>
                    </div>
                    <div class="asset-card" id="assetSOL" data-symbol="SOL">
                        <span class="asset-symbol">SOL</span>
                        <span class="asset-price">◎ 145</span>
                        <span class="asset-change">+3.1%</span>
                    </div>
                </div>
            </div>
            <!-- TradingView Panel -->
            <div class="glass-panel tradingview-panel">
                <div class="tradingview-header">
                    <span class="title">График BTC/USDT</span>
                    <div class="tradingview-tools">
                        <button>Индикаторы</button>
                        <button>Инструменты</button>
                        <button id="focusBtn">Фокус</button>
                    </div>
                </div>
                <!-- TradingView Widget (Demo) -->
                <iframe class="tradingview-iframe"
                    src="https://s.tradingview.com/widgetembed/?symbol=BINANCE:BTCUSDT&interval=60&theme=dark"
                    frameborder="0"
                    allowtransparency="true"
                    scrolling="no"
                    title="TradingView Chart"></iframe>
                <!-- Order Form -->
                <div class="order-form-panel">
                    <label for="orderType">Тип ордера</label>
                    <select id="orderType">
                        <option value="market">Рыночный</option>
                        <option value="limit">Лимитный</option>
                        <option value="stop">Стоп</option>
                    </select>
                    <label for="orderAmount">Количество</label>
                    <input type="number" id="orderAmount" placeholder="Введите сумму">
                    <label for="orderPrice">Цена (для лимит/стоп)</label>
                    <input type="number" id="orderPrice" placeholder="Введите цену">
                    <button id="orderSubmitBtn">Купить</button>
                </div>
            </div>
            <!-- Order Book & Trade History -->
            <div>
                <div class="glass-panel orderbook-panel">
                    <div style="font-weight:600;color:var(--accent);margin-bottom:0.5rem;">Стакан ордеров</div>
                    <table class="orderbook-table">
                        <thead>
                            <tr>
                                <th>Цена</th>
                                <th>Кол-во</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td style="color:var(--danger);">67,210</td><td>0.12</td></tr>
                            <tr><td style="color:var(--danger);">67,205</td><td>0.08</td></tr>
                            <tr><td style="color:var(--success);">67,200</td><td>0.15</td></tr>
                            <tr><td style="color:var(--success);">67,195</td><td>0.09</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="glass-panel tradehistory-panel">
                    <div style="font-weight:600;color:var(--accent);margin-bottom:0.5rem;">Лента сделок</div>
                    <table class="tradehistory-table">
                        <thead>
                            <tr>
                                <th>Время</th>
                                <th>Цена</th>
                                <th>Кол-во</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>12:01:23</td><td style="color:var(--success);">67,200</td><td>0.03</td></tr>
                            <tr><td>12:01:18</td><td style="color:var(--danger);">67,205</td><td>0.02</td></tr>
                            <tr><td>12:01:10</td><td style="color:var(--success);">67,195</td><td>0.05</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- Academy Section -->
        <div class="academy-section">
            <div class="academy-title">CryptoBlur Academy</div>
            <div class="academy-cards">
                <div class="academy-card">
                    <span class="icon">📈</span>
                    <span class="card-title">Основы трейдинга</span>
                    <span class="card-desc">Краткие статьи о базовых принципах торговли криптовалютами.</span>
                </div>
                <div class="academy-card">
                    <span class="icon">🛡️</span>
                    <span class="card-title">Управление рисками</span>
                    <span class="card-desc">Видео и советы по контролю рисков и сохранению капитала.</span>
                </div>
                <div class="academy-card">
                    <span class="icon">🔍</span>
                    <span class="card-title">Технический анализ</span>
                    <span class="card-desc">Обзор популярных индикаторов и стратегий анализа графиков.</span>
                </div>
            </div>
        </div>
    </div>
    <!-- JS for Blur Background, Market Indicator, Focus Mode, Chart, Notification -->
    <script>
        // Animated Blur Background (abstract gradient blobs)
        const blurBgCanvas = document.getElementById('blurBgCanvas');
        const ctx = blurBgCanvas.getContext('2d');
        // Resize canvases (ensure devicePixelRatio aware)
        function resizeBlurBg() {
            const dpr = window.devicePixelRatio || 1;
            blurBgCanvas.width = Math.floor(window.innerWidth * dpr);
            blurBgCanvas.height = Math.floor(window.innerHeight * dpr);
            blurBgCanvas.style.width = window.innerWidth + 'px';
            blurBgCanvas.style.height = window.innerHeight + 'px';
            ctx.setTransform(dpr,0,0,dpr,0,0);
            // market indicator canvas
            const micDpr = window.devicePixelRatio || 1;
            marketIndicatorCanvas.width = Math.floor(marketIndicatorCanvas.clientWidth * micDpr);
            marketIndicatorCanvas.height = Math.floor(marketIndicatorCanvas.clientHeight * micDpr);
            marketIndicatorCanvas.style.width = marketIndicatorCanvas.clientWidth + 'px';
            marketIndicatorCanvas.style.height = marketIndicatorCanvas.clientHeight + 'px';
            mictx.setTransform(micDpr,0,0,micDpr,0,0);
        }
        window.addEventListener('resize', resizeBlurBg);
        resizeBlurBg();
        // Blob objects
        const blobs = [
            {x: 300, y: 400, r: 220, c: '#7f5af0', dx: 0.7, dy: 0.5},
            {x: 900, y: 200, r: 180, c: '#2ce59b', dx: -0.5, dy: 0.6},
            {x: 600, y: 700, r: 260, c: '#ff3c6e', dx: 0.4, dy: -0.7},
            {x: 1200, y: 600, r: 180, c: '#181c2f', dx: -0.6, dy: 0.3}
        ];
        function animateBlurBg() {
            ctx.clearRect(0, 0, blurBgCanvas.width, blurBgCanvas.height);
            blobs.forEach(blob => {
                ctx.save();
                ctx.globalAlpha = 0.38;
                const grad = ctx.createRadialGradient(blob.x, blob.y, blob.r*0.3, blob.x, blob.y, blob.r);
                grad.addColorStop(0, blob.c);
                grad.addColorStop(1, '#181c2f00');
                ctx.fillStyle = grad;
                ctx.beginPath();
                ctx.arc(blob.x, blob.y, blob.r, 0, 2*Math.PI);
                ctx.fill();
                ctx.restore();
                // Move blobs
                blob.x += blob.dx;
                blob.y += blob.dy;
                if(blob.x < 0 || blob.x > blurBgCanvas.width) blob.dx *= -1;
                if(blob.y < 0 || blob.y > blurBgCanvas.height) blob.dy *= -1;
            });
            // Faint numbers/graphics
            ctx.save();
            ctx.globalAlpha = 0.09;
            ctx.font = "bold 120px Inter";
            ctx.fillStyle = "#fff";
            ctx.fillText("BTC", 180, 220);
            ctx.fillText("Ξ", 900, 320);
            ctx.fillText("◎", 600, 600);
            ctx.restore();
            requestAnimationFrame(animateBlurBg);
        }
        animateBlurBg();

        // Emotional Market Indicator (animated sphere)
        const marketIndicatorCanvas = document.getElementById('marketIndicatorCanvas');
        const mictx = marketIndicatorCanvas.getContext('2d');
        let marketState = 'calm'; // calm, up, down, panic
        function drawMarketIndicator() {
            mictx.clearRect(0,0,marketIndicatorCanvas.width,marketIndicatorCanvas.height);
            let color = '#7f5af0', pulse = 1, chaos = 0;
            if(marketState==='up') { color = '#2ce59b'; pulse = 1.2; chaos = 0.1;}
            if(marketState==='down') { color = '#ff3c6e'; pulse = 1.3; chaos = 0.2;}
            if(marketState==='panic') { color = '#ff3c6e'; pulse = 1.5; chaos = 0.5;}
            // Animated sphere
            const t = Date.now()/600;
            mictx.save();
            mictx.translate(marketIndicatorCanvas.width/2, marketIndicatorCanvas.height/2);
            for(let i=0;i<18;i++) {
                const angle = i*2*Math.PI/18 + Math.sin(t/2+i)*chaos;
                const r = 28 + Math.sin(t+i)*pulse*4 + Math.cos(t/2+i)*chaos*8;
                mictx.beginPath();
                mictx.arc(Math.cos(angle)*r, Math.sin(angle)*r, 8, 0, 2*Math.PI);
                mictx.fillStyle = color;
                mictx.globalAlpha = 0.18 + 0.12*Math.sin(t+i);
                mictx.fill();
            }
            mictx.beginPath();
            mictx.arc(0,0,24+Math.sin(t)*pulse*2,0,2*Math.PI);
            mictx.fillStyle = color;
            mictx.globalAlpha = 0.38;
            mictx.fill();
            mictx.restore();
            requestAnimationFrame(drawMarketIndicator);
        }
        drawMarketIndicator();

        // Portfolio Donut Chart (demo)
        const portfolioChart = document.getElementById('portfolioChart');
        const pct = portfolioChart.getContext('2d');
        function drawPortfolioChart() {
            pct.clearRect(0,0,120,120);
            const data = [
                {v: 60, c:'#7f5af0'},
                {v: 25, c:'#2ce59b'},
                {v: 15, c:'#ff3c6e'}
            ];
            let start = -Math.PI/2;
            data.forEach(d=>{
                pct.beginPath();
                pct.arc(60,60,48,start,start+2*Math.PI*d.v/100);
                pct.lineWidth = 18;
                pct.strokeStyle = d.c;
                pct.globalAlpha = 0.7;
                pct.stroke();
                start += 2*Math.PI*d.v/100;
            });
            pct.globalAlpha = 1;
            pct.beginPath();
            pct.arc(60,60,32,0,2*Math.PI);
            pct.fillStyle = 'rgba(24,28,47,0.7)';
            pct.fill();
        }
        drawPortfolioChart();

        // --- Theme presets and dynamic theming ---
        const themes = {
            'BTC': {
                accent: '#ff7a29',
                accentGlow: '#ff7a2999',
                bg1: '#2b1200',
                bg2: '#10100b',
                portfolioGlow: 'rgba(255,122,41,0.35)'
            },
            'ETH': {
                accent: '#7f5af0',
                accentGlow: '#7f5af0cc',
                bg1: '#181c2f',
                bg2: '#2d1a3a',
                portfolioGlow: 'rgba(127,90,240,0.22)'
            },
            'SOL': {
                accent: '#2ce59b',
                accentGlow: '#2ce59b88',
                bg1: '#06261a',
                bg2: '#102d24',
                portfolioGlow: 'rgba(44,229,155,0.2)'
            }
        };

        // applyTheme: updates CSS variables; transition is handled by CSS transitions above
        function applyTheme(key) {
            const root = document.documentElement;
            if(!key || key === 'auto') return;
            const p = themes[key];
            if(!p) return;
            root.style.setProperty('--accent', p.accent);
            root.style.setProperty('--accent-glow', p.accentGlow);
            root.style.setProperty('--bg-color-1', p.bg1);
            root.style.setProperty('--bg-color-2', p.bg2);
            root.style.setProperty('--portfolio-glow', p.portfolioGlow);
            // Update glass border tint subtly
            root.style.setProperty('--glass-border', `1.5px solid ${hexToRgba(p.accent,0.18)}`);
        }
        function hexToRgba(hex, a=1){
            const c = hex.replace('#','');
            const bigint = parseInt(c.length===3? c.split('').map(ch=>ch+ch).join(''):c,16);
            const r=(bigint>>16)&255,g=(bigint>>8)&255,b=bigint&255;
            return `rgba(${r},${g},${b},${a})`;
        }

        // Theme selector + asset card click -> set theme (auto option still allowed)
        const themeSelect = document.getElementById('themeSelect');
        themeSelect.addEventListener('change', ()=>{
            const val = themeSelect.value;
            if(val === 'auto'){ localStorage.removeItem('forcedTheme'); return; }
            localStorage.setItem('forcedTheme', val);
            applyTheme(val);
        });
        // If user previously selected theme, restore
        const forced = localStorage.getItem('forcedTheme');
        if(forced){ themeSelect.value = forced; applyTheme(forced); }

        // Asset card clicks trigger theme switch (unless user forced a theme)
        document.querySelectorAll('.asset-card').forEach(card=>{
            card.addEventListener('click', ()=>{
                const s = card.dataset.symbol;
                const forcedTheme = localStorage.getItem('forcedTheme');
                if(forcedTheme && forcedTheme !== 'auto') return; // respect forced theme
                if(themes[s]) applyTheme(s);
            });
        });

        // --- Portfolio volatility -> pulse mapping (demo) ---
        let recentPrices = []; // sliding window
        const windowSize = 30; // sample count (demo)
        // demo base price and update (in real app - feed from API)
        let demoPrice = 67200;
        function pushPrice(p){
            recentPrices.push(p);
            if(recentPrices.length > windowSize) recentPrices.shift();
        }
        function stddev(arr){
            if(arr.length===0) return 0;
            const mean = arr.reduce((a,b)=>a+b,0)/arr.length;
            const v = Math.sqrt(arr.reduce((s,x)=>s+(x-mean)*(x-mean),0)/arr.length);
            return v;
        }
        function updatePulseFromVolatility(){
            if(recentPrices.length < 4) return;
            const sd = stddev(recentPrices);
            // map sd to pulseScale [1.0 .. 1.06] and duration [2.5s .. 0.6s]
            const maxSd = 300; // demo mapping scale (tweak to real data)
            const norm = Math.min(sd / maxSd, 1);
            const scale = 1 + norm * 0.06;
            const duration = (2.5 - norm * 1.9).toFixed(2) + 's';
            document.documentElement.style.setProperty('--pulse-scale', scale);
            document.documentElement.style.setProperty('--pulse-duration', duration);
            // optionally change glow color intensity when volatility high
            if(norm > 0.6) {
                document.documentElement.style.setProperty('--portfolio-glow', 'rgba(255,60,110,0.28)');
            } else {
                // keep accent-based glow
                const currentAccent = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#7f5af0';
                document.documentElement.style.setProperty('--portfolio-glow', hexToRgba(currentAccent, 0.24));
            }
        }
        // Demo incoming prices
        setInterval(()=>{
            // small random walk; occasionally spike for demo
            const spike = Math.random() < 0.06 ? (Math.random()*1200 - 600) : (Math.random()*40 - 20);
            demoPrice = Math.max(100, demoPrice + spike);
            pushPrice(demoPrice);
            updatePulseFromVolatility();
            // update displayed portfolio balance for demo
            const balEl = document.getElementById('portfolioBalance');
            if(balEl){
                const display = (demoPrice/1000).toFixed(2);
                balEl.textContent = `₿ ${display}`;
            }
        }, 2000);

        // --- Settings sliders: blur and glass opacity (persisted) ---
        const blurSlider = document.getElementById('blurSlider');
        const glassSlider = document.getElementById('glassSlider');
        // restore
        const savedBlur = localStorage.getItem('cb_blur');
        const savedGlass = localStorage.getItem('cb_glass');
        if(savedBlur) { document.documentElement.style.setProperty('--glass-blur', `blur(${savedBlur}px)`); blurSlider.value = savedBlur; }
        if(savedGlass) { document.documentElement.style.setProperty('--glass-opacity', savedGlass); glassSlider.value = savedGlass; }
        blurSlider.addEventListener('input', ()=> {
            const v = blurSlider.value;
            document.documentElement.style.setProperty('--glass-blur', `blur(${v}px)`);
            localStorage.setItem('cb_blur', v);
        });
        glassSlider.addEventListener('input', ()=>{
            const v = glassSlider.value;
            document.documentElement.style.setProperty('--glass-opacity', v);
            // update derived --glass-bg automatically (uses var in CSS)
            localStorage.setItem('cb_glass', v);
        });

        // Helper: if user clicks a theme option set to auto, it will allow asset clicks to control theme
        // initial apply if forced or matching asset initial selection (demo picks BTC)
        if(!forced) {
            // apply theme based on initial highlighted asset (BTC default)
            applyTheme('BTC');
        }

        // Focus Mode
        const focusBtn = document.getElementById('focusBtn');
        const focusOverlay = document.getElementById('focusOverlay');
        let focusActive = false;
        focusBtn.addEventListener('click', ()=>{
            focusActive = !focusActive;
            focusOverlay.classList.toggle('active', focusActive);
        });
        focusOverlay.addEventListener('click', ()=>{
            focusActive = false;
            focusOverlay.classList.remove('active');
        });

        // Notification (custom alert)
        function showNotification(msg) {
            const notification = document.getElementById('notification');
            notification.textContent = msg;
            notification.classList.add('active');
            setTimeout(()=>notification.classList.remove('active'), 3500);
        }

        // Order Form Demo
        document.getElementById('orderSubmitBtn').addEventListener('click', ()=>{
            showNotification('Ордера отправлен (демо)');
        });

        // Asset Card Glow Demo (price change)
        function pulseAssetCard(id, type) {
            const card = document.getElementById(id);
            card.classList.remove('glow-success','glow-danger');
            void card.offsetWidth; // force reflow
            if(type==='up') card.classList.add('glow-success');
            if(type==='down') card.classList.add('glow-danger');
            setTimeout(()=>card.classList.remove('glow-success','glow-danger'), 900);
        }
        // Demo: pulse BTC card green every 8s, ETH red every 12s
        setInterval(()=>pulseAssetCard('assetBTC','up'),8000);
        setInterval(()=>pulseAssetCard('assetETH','down'),12000);

        // Demo: market indicator state change
        setInterval(()=>{
            const states = ['calm','up','down','panic'];
            marketState = states[Math.floor(Math.random()*states.length)];
        },9000);

        // Add neon animation effects
        function animateNeonSymbols() {
            const symbols = document.querySelectorAll('.crypto-symbol');
            symbols.forEach(symbol => {
                const x = Math.random() * window.innerWidth;
                const y = Math.random() * window.innerHeight;
                const duration = 10 + Math.random() * 20;

                symbol.style.transition = `all ${duration}s linear`;
                symbol.style.transform = `translate(${x}px, ${y}px)`;
            });
        }

        // Move symbols every 15 seconds
        setInterval(animateNeonSymbols, 15000);
        animateNeonSymbols();

        // Handle navigation (demo)
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                if(link.getAttribute('href') === '#') {
                    e.preventDefault();
                    showNotification('Demo: Page navigation');
                }
            });
        });
    </script>
</body>
</html>
